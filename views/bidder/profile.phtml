<?php
if (!is_null($this->get('profile'))) {
    $auction    = $this->get('auction');
    $profile    = $this->get('profile');
    $losing     = $this->get('losing');
    $winning    = $this->get('winning');
    $purchases  = $this->get('purchases');
    $maxBids    = $this->get('maxBids');
    $total      = $this->get('totalSpent');
    $myAuctions = $this->get('myAuctions');
    $bidderName = strtoupper($profile->firstName[0]) . '. ' . $profile->lastName;
    $redirect   = $_SERVER['REQUEST_URI'];
    $bidderPage = is_page('bidder');
} else {
    return;
}
?>
<div class="bidder-info-container">
    <div class="container container-fluid underlined">
        <div class="row meta">
            <div class="pin col-md-6 col-xs-6">
                <label>Pin Code:</label>
                <?php echo $profile->pin; ?>
            </div>
            <div class="auction col-md-6 col-xs-6">
                <?php
                if($auction) {
                    echo $auction->name;
                } else { ?>
                <?php } ?>
            </div>
        </div>

        <div class="row slider-nav slider-nav-mobile" data-slider-nav-id="bidder-dashboard">

            <div class="col-xs-9">

                <div class="pin col-md-12 col-xs-12">
                    <label>Pin Code:</label>
                    <?php echo $profile->pin; ?>
                </div>

                <a class="col-xs-12 profile-user-info" data-slider-nav-key="profile-user-info">
                    <span><?php echo $bidderName; ?></span>
                </a>

            </div>
            <a class="col-xs-3 total-spent">

                <span>$<span data-handbid-stats-grand-total><?php echo $total; ?></span></span>
                <label>Total</label>

            </a>

        </div>

        <div class="row slider-nav slider-nav-desktop stats-bar <?php echo ($bidderPage) ? 'auto-open' : ''; ?>" data-slider-nav-id="bidder-dashboard" data-toggle-mode="true">
            <a class="col-md-<?php echo ($auction) ? '2' : '3'; ?> col-xs-8 profile-user-info" data-slider-nav-key="profile-user-info">
                <span><?php echo $bidderName; ?></span>
            </a>
            <?php if($auction) { ?>
                <a class="col-md-2 col-sm-3 col-xs-3 profile-max-bids" data-slider-nav-key="profile-max-bids">
                    <label>Max Bids</label>
                    <span data-handbid-stats-num-proxies><?php echo ($maxBids) ? count($maxBids) : '0'; ?></span>
                </a>
                <a class="col-md-2 col-sm-3 col-xs-3 profile-winning" data-slider-nav-key="profile-winning">
                    <label>Winning</label>
                    <span data-handbid-stats-num-winning><?php echo ($winning) ? count($winning) : '0'; ?></span>
                </a>
                <a class="col-md-2 col-sm-3 col-xs-3 profile-losing" data-slider-nav-key="profile-losing">
                    <label>Losing</label>
                    <span data-handbid-stats-num-losing><?php echo ($losing) ? count($losing) : '0'; ?></span>
                </a>
                <a class="col-md-2 col-sm-3 col-xs-3 profile-purchases" data-slider-nav-key="profile-purchases">
                    <label>Purchases</label>
                    <span data-handbid-stats-num-purchases><?php echo ($purchases) ? count($purchases) : '0'; ?></span>
                </a>
                <a class="col-md-2 col-xs-12 total-spent">
                    <label>Total</label>
                    <span>$<span data-handbid-stats-grand-total><?php echo $total; ?></span></span>
                </a>
            <?php } ?>
        </div>
    </div>
    <div class="full-width-container bidder-info-body">
        <div class="container container-fluid">
            <div class="slider-content" data-slider-nav-id="bidder-dashboard">

                <div class="row" data-slider-nav-key="profile-user-info">

                    <?php echo $this->partial('user-info.phtml', [
                        'profile'    => $profile,
                        'winning'    => $winning,
                        'losing'     => $losing,
                        'redirect'   => $redirect,
                        'myAuctions' => $myAuctions
                    ]);
                    ?>
                </div>

                <div class="row" data-slider-nav-key="profile-max-bids">
                    <div class="col-md-12">
                        <ul class="simple-list">
                            <?php
                            if(count($maxBids) > 0) {
                                forEach($maxBids as $bid) {
                                    ?>
                                    <li class="row">
                                        <div class="col-md-8 col-xs-8">
                                            <a href="/auctions/<?php echo $auction->key; ?>/item/<?php echo $bid->item->key; ?>"><h4><?php echo $bid->item->name; ?></h4></a>
                                        </div>
                                        <div class="col-md-2 col-xs-2">
                                            <span class="bid-amount winning">$<span><?php echo (int) $bid->maxAmount; ?></span></span>
                                        </div>
                                        <div class="col-md-2 col-xs-2">
                                            <a class="button pink-solid-button" href="#" data-handbid-delete-proxy="<?php echo $bid->id; ?>"><?php echo __('Delete'); ?></a>
                                        </div>
                                    </li>
                                <?php
                                }
                            } else {
                                ?>
                                <p>You have not set any max bids on items.</p>
                            <?php
                            }
                            ?>
                        </ul>
                    </div>
                </div>

                <div class="row" data-slider-nav-key="profile-winning">
                    <div class="col-md-12">
                        <ul class="simple-list">
                            <?php
                            if(count($winning) > 0 ) {
                                forEach($winning as $bid) {
                                    ?>
                                    <li class="row">
                                        <div class="col-md-10 col-xs-10">
                                            <a href="/auctions/<?php echo $auction->key; ?>/item/<?php echo $bid->item->key; ?>"><h4><?php echo $bid->item->name; ?></h4></a>
                                        </div>
                                        <div class="col-md-2 col-xs-2">
                                            <span class="bid-amount winning">$<span><?php echo (int) $bid->amount; ?></span></span>
                                        </div>
                                    </li>
                                <?php
                                }
                            } else {
                                ?>
                                <p>You are currently not winning any items.</p>
                            <?php
                            }
                            ?>
                        </ul>
                    </div>
                </div>

                <div class="row" data-slider-nav-key="profile-losing">
                    <div class="col-md-12">
                        <ul class="simple-list">
                            <?php
                            if(count($losing) > 0 ) {
                                forEach($losing as $bid) {
                                    ?>
                                    <li class="row">
                                        <div class="col-md-8 col-xs-8">
                                            <a href="/auctions/<?php echo $auction->key; ?>/item/<?php echo $bid->item->key; ?>"><h4><?php echo $bid->item->name; ?></h4></a>
                                        </div>
                                        <div class="col-md-4 col-xs-4">
                                            <span class="bid-amount losing">$<span><?php echo (int) $bid->amount; ?></span></span>
                                        </div>
                                    </li>
                                <?php
                                }
                            } else {
                                ?>
                                <p>You are currently not losing any items.</p>
                            <?php
                            }
                            ?>
                        </ul>
                    </div>
                </div>

                <div class="row" data-slider-nav-key="profile-purchases">
                    <div class="col-md-12">
                        <ul class="simple-list">
                            <?php
                            if(count($purchases) > 0 ) {
                                forEach($purchases as $purchase) {
                                    ?>
                                    <li class="row">
                                        <div class="col-md-4 col-xs-4">
                                            <a href="/auctions/<?php echo $auction->key; ?>/item/<?php echo $purchase->item->key; ?>"><h4><?php echo explode(' x ', $purchase->name)[0]; ?></h4></a>
                                        </div>
                                        <div class="col-md-4 col-xs-4">
                                            <h4 class="quantity-total"><?php echo $purchase->quantity; ?> x $<?php echo $purchase->pricePerItem; ?></h4>
                                        </div>
                                        <div class="col-md-4 col-xs-4">
                                            <span class="bid-amount winning">$<span><?php echo $purchase->grandTotal; ?></span></span>
                                        </div>
                                    </li>
                                <?php
                                }
                            } else {
                                ?>
                                <p>You have not purchased any items.</p>
                            <?php
                            }
                            ?>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>