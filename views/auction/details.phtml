<?php
/**
 * @copyright Copyright (c) 2014-2015 Handbid Inc.
 * @category handbid
 * @package Handbid2-WordPress
 * @license Proprietary
 * @link http://www.handbid.com/
 * @author Master of Code (worldclass@masterofcode.com)
 */

$auction = $this->get('auction');
if (!$auction)
{
    return '';
}

$items       = $this->get('items');
$winning     = $this->get('winning');
$losing      = $this->get('losing');
$colsCount   = $this->get('cols_count');
$profile     = $this->get('profile');
$location    = $this->get('location');
$hasLocation = $this->get('hasLocation');
$address     = null;
$mapsUrl     = null;
$categories  = $this->get('categories');
$categories  = $auction->categories;

$categoriesOutput                = [];
$output_categories               = [];
$first_category_items            = [];
$auctionStatusIsPresaleOrPreview = in_array($auction->status, array("presale", "preview"));
$auctionStatusIsPresale          = in_array($auction->status, array("presale"));
$allItemsCount                   = 0;
$counter                         = 0;
foreach ($categories as $category_single)
{
    $temp = [
        'id'    => $category_single->id,
        'name'  => $category_single->name,
        'count' => 0,
        'items' => [],
        'real_items' => [],
    ];
    foreach ($category_single->items as $item_single)
    {
        $availableForPreSale        = ($item_single->availableForPreSale == "1");
        $isDirectPurchaseItem       = ($item_single->isDirectPurchaseItem);
        $itemCanNotBeShownInPresale = ($auctionStatusIsPresale && !($isDirectPurchaseItem && $availableForPreSale));

        $hideItemIfSold = (($item_single->isHidden == "1") or (($item_single->hideSales == 1) && $item_single->status == "sold"));

        if (!$itemCanNotBeShownInPresale && !$hideItemIfSold && !$item_single->isHidden)
        {
            $temp['count'] += 1;
            $temp['items'][] = $item_single->name;
            $temp['real_items'][] = $item_single;
        }
    }
    if ($temp['count'])
    {
        $allItemsCount += $temp['count'];

        if($counter){
            $output_categories[$category_single->id] = $category_single->id;
        }
        else{
            $first_category_items = $temp['real_items'];
        }

        unset($temp['real_items']);

        $categoriesOutput[$category_single->id] = $temp;
        $counter++;
    }
}


$locationStreet1       = ($hasLocation) ? $location->auctionLocationStreet1 : "";
$locationStreet2       = ($hasLocation) ? $location->auctionLocationStreet2 : "";
$locationPCode         = ($hasLocation) ? $location->auctionLocationPostalCode : "";
$locationCity          = ($hasLocation) ? $location->auctionLocationCity : "";
$locationProvince      = ($hasLocation) ? ((isset($location->province)) ? $location->province->countriesRegionsName : "") : "";
$locationProvinceShort = ($hasLocation) ? ((isset($location->province)) ? $location->province->countriesRegionsShortName : "") : "";

if ($hasLocation)
{

    $address = $locationStreet1 . ', ' . $locationStreet2 . ', ' . $locationCity . ', ' . $locationProvince . ', ' . $locationPCode;
}

$currencyCode   = (isset($auction->currencyCode)) ? $auction->currencyCode : HANDBID_DEFAULT_CURRENCY;
$currencySymbol = (isset($auction->currencySymbol)) ? $auction->currencySymbol : HANDBID_DEFAULT_CURRENCY_SYMBOL;

?>

<div class="auction-details <?php echo $auction->status; ?>"
     data-handbid-auction-guid="<?php echo $auction->auctionGuid; ?>">

    <div class="container container-fluid detail-banner-wrapper">
        <div class="detail-banner" style="background-image: url('<?php
        $image = ($auction->bannerImage) ? $auction->bannerImage : $auction->organization->banner;
        $image = (strpos($image, "ucarecdn") !== false && strpos($image, "preview") === false) ? $image . "-/preview/1140x280/" : $image;
        echo $image; ?>')">
            <div class="logo">
                <a href="/organizations/<?php echo $auction->organizationKey; ?>/" style="cursor: pointer;">
                    <img src="<?php
                    $image        = ($auction->imageUrl) ? $auction->imageUrl : $auction->sponsorImage;
                    $imageUrlPath = parse_url($image);
                    $image        = ($imageUrlPath["scheme"]) ? $image : "https://" . $image;
                    $imageLogo        = (strpos($image, "ucarecdn") !== false && strpos($image, "preview") === false) ? $image . "-/preview/120x120/" : $image;
                    echo $imageLogo;
                    ?>"/>
                </a>
            </div>
        </div>
        <div class="controls">

            <?php echo do_shortcode('[handbid_social_share]'); ?>

        </div>

        <ul class="action-list flex-list">
            <li>
                <h3>BROWSE AUCTION</h3>
                <p>Browse, bid, and buy in the auction</p>
                <a class="button pink-button register" href="/auction/<?php echo $auction->key; ?>/details/items/">BROWSE NOW</a>
            </li>
            <?php if (!$profile)
            { ?>
                <li>
                    <h3>REGISTER</h3>
                    <p>Register now to bid in this auction.</p>
                    <a class="button pink-button register"
                       data-handbid-connect
                       data-tickets-enabled="<?php echo ($auction->enableTicketSales) ? 'yes' : 'no' ?>"
                       href="#">Register now</a>
                </li>
            <?php } ?>
            <li>
                <h3>DONATE</h3>
                <p>Make a donation to Auction</p>
                <a class="button pink-button register" href="/auction/<?php echo $auction->key; ?>/details/donations/">Donate NOW</a>
            </li>
            <?php if ($auction->enableTicketSales && $profile)
            { ?>
                <li>
                    <h3>BUY TICKETS</h3>
                    <p>Buy Tickets to  the in-person event</p>
                    <a class="button pink-button  handbid-modal-link purchase-tickets"data-handbid-credit-cards-need
                       data-handbid-tickets="open-button" >Buy now</a>
                </li>
            <?php } ?>
        </ul>
    </div>

    <div class="about-us container container-fluid">
        <h2>ABOUT US</h2>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
        </p>
        <ul class="flex-list">
            <li>
                <img src="<?php echo HANDBID_PLUGIN_URL; ?>/public/images/auction-details/img1.jpg" alt="about us">
            </li>
            <li>
                <img src="<?php echo HANDBID_PLUGIN_URL; ?>/public/images/auction-details/img2.jpg" alt="about us">
            </li>
            <li>
                <img src="<?php echo HANDBID_PLUGIN_URL; ?>/public/images/auction-details/img3.jpg" alt="about us">
            </li>
        </ul>
    </div>

    <a class="social-responsibility  container container-fluid">
        <img src="<?php echo HANDBID_PLUGIN_URL; ?>/public/images/auction-details/responsibility.png" alt="responsibility">
    </a>

</div>

<?php if ($auction->timerRemaining > 0)
{
    ?>
    <input type="hidden" id="timerRemaining" data-auction-name="<?php echo $auction->name; ?>"
           value="<?php echo $auction->timerRemaining; ?>">
    <?php
} ?>
