<?php
if ($this->auction) {

    $auction  = $this->get('auction');
    $coords   = $auction->location->coords;
    $location = $auction->location;

    if (isset($auction->meta)) {
        $org = $auction->meta->organization;
    }

} else {

    echo "No Auction Set";
    return;
}

if (!$coords || !$org) {
    return;
}

$dateFormat = 'm/d/Y h:i a';

// @Todo Fix url w/ query params, Horrible way to do this, sorry!
$url = get_permalink() . '?auction=' . get_query_var('auction');

?>
<div class="map-frame">
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false">
    </script>
    <div style="width:100%;">
        <div style="overflow:hidden; height:250px; width:100%;">
            <div id="gmap_canvas" style="height:250px; width:100%;">
            </div>
            <a href="http://www.embed-google-map.com" class="map-data">http://www.embed-google-map.com</a>
            <iframe src="http://www.embed-google-map.com/google-map-data.php"></iframe>
            <style>
                .gmap {
                    position: relative;
                    line-height: 1.12;
                    overflow: hidden;
                    color: #000;
                    white-space: nowrap;
                    display: block;
                    margin-bottom: 2px;
                    font-weight: 500;
                }
            </style>
        </div>
        <script type="text/javascript">function init_map() {
                var myOptions = {
                    zoom:        15,
                    center:      new google.maps.LatLng(<?php echo $coords->lat; ?>, <?php echo $coords->lon; ?>),
                    mapTypeId:   google.maps.MapTypeId.ROADMAP,
                    scrollwheel: false
                };
                map = new google.maps.Map(document.getElementById("gmap_canvas"), myOptions);
                marker = new google.maps.Marker({map: map, position: new google.maps.LatLng(<?php echo $coords->lat; ?>, <?php echo $coords->lon; ?>)});
                infowindow = new google.maps.InfoWindow({content: "<span class='gmap'><b><?php echo $auction->name; ?></b></span><span class='gmap'><?php echo $auction->vanityAddress; ?></span><span class='gmap'></span>" });
                google.maps.event.addListener(marker, "click", function () {
                    infowindow.open(map, marker);
                });
                infowindow.open(map, marker);
            }
            google.maps.event.addDomListener(window, "load", init_map);
        </script>
    </div>
</div>

