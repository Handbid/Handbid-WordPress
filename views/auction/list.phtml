<?php
if ($this->context[0] && $this->context[1]) {
    $categories = $this->context[0];
    $items      = $this->context[1];
    $donors     = array_unique($items);

    $priceRanges = [
        '_all' => 'All',
        '_0'   => '0 - 100',
        '_1'   => '101 - 250',
        '_2'   => '251 - 500',
        '_5'   => '501+'
    ];

} else {
    echo "No Categories / Items Found";
    return;
}

?>

<div class="auctionItemListWidget">

    <!-- Filtering Side Bar -->
    <div class="sideBar widgetContainer filterBar">
        <h3><?= __('Auction Items'); ?></h3>

        <label><?= __('Show Items'); ?> :</label>
        <ul>
            <li><input type="radio" name="items" value="all">All Items</li>
            <li><input type="radio" name="items" value="forSale">For Sale</li>
            <li><input type="radio" name="items" value="live">Live</li>
            <li><input type="radio" name="items" value="extended">Extended</li>
            <li><input type="radio" name="items" value="noBids">No Bids</li>
            <li><input type="radio" name="items" value="favorites">Favorites</li>
        </ul>

        <label><?= __('Categories'); ?>:</label>
        <ul class="categorySort">
            <li><input class="input all" type="radio" name="category" value="all"><?= __('All'); ?></li>
            <?php

            forEach ($categories as $category) {
                ?>
                <li><input class="input" type="radio" name="category" value="<?= sanitize_html_class($category['name']); ?>"><?= __($category['name']); ?></li>
            <?php
            }

            ?>
        </ul>

        <label><?= __('Price Ranges'); ?>:</label>
        <ul class="priceSort">
            <?php
            forEach($priceRanges as $k => $v ) {
                ?>
                <li><input type="radio" name="priceRange" value="<?= $k; ?>"><?= $v; ?></li>
            <?php
            }
            ?>
        </ul>
    </div>

    <!-- Item List -->
    <div class="itemList">

        <div class="filterBar">
            <label><?= __('Filter By'); ?> :</label>

            <select>
                <option value="price-range">Donor</option>
                <?php
                forEach ($donors as $donor) {
                    ?>
                    <option value="<?= $donor['_id']; ?>"><?= $donor['name']; ?></option>
                <?php
                }
                ?>
            </select>

            <select>
                <option value="price-range">Bids</option>
                <option value="price-range">1</option>
                <option value="price-range">2</option>
            </select>

            <a href="#"><?= __('Clear Filters'); ?></a>
        </div>
        <ul id="container" class="items js-isotope">
            <?php forEach ($items as $item) {

                // By default no filtering is done
                $priceClass = '_all';

                if($item['currentPrice'] >= 0 && $item['currentPrice'] <= 100 ) {
                    $priceClass = '_0';
                }
                else if($item['currentPrice'] >= 101 && $item['currentPrice'] < 250) {
                    $priceClass = '_1';
                }
                else if($item['currentPrice'] >= 251 && $item['currentPrice'] < 500) {
                    $priceClass = '_2';
                }
                else if($item['currentPrice'] >= 501) {
                    $priceClass = '_5';
                }

                ?>
                <li class="item item-tile <?= sanitize_html_class($item['_restMetaData']['categoryName']) . ' ' . $priceClass; ?> all _all">
                    <a href="/auction-item/?item=<?= $item['_id']; ?>">
                        <div class="item-content-inner">
                            <div class="image" style="background-image: url(<?= $item['images'][0]; ?>);">
                                <div class="block currentPrice">
                                    <span><?= __('Current bid'); ?></span><span class="price"><?= '$' . $item['currentPrice']; ?></span></div>
                                <div class="block itemCode"><?= __('Item Code') . ' : ' . $item['itemCode']; ?></div>
                            </div>
                            <div class="details">
                                <h2><?= $item['name']; ?></h2>
                                <div class="bidIncrement"><?= __('Bid Increment') . ': $' . $item['bidIncrement']; ?></div>
                                <div class="category">Category: Sports</div>
                            </div>
                        </div>
                    </a>
                    <div class="footer">
                        <div class="stat bidCount"><div class="icon"></div><?= $item['_restMetaData']['totalBids']; ?></div>
                        <div class="stat favCount"><div class="icon"></div>20</div>
                        <div class="stat viewCount"><div class="icon"></div>200</div>
                    </div>
                </li>

            <?php } ?>
        </ul>
    </div>
</div>

